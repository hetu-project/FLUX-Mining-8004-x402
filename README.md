# FLUX Mining with ERC-8004 Identity & x402 Payment Escrow

A trustless AI agent infrastructure combining **ERC-8004 decentralized identity**, **x402 payment protocol**, and **Proof-of-Causal-Work consensus** to mine soulbound FLUX tokens through verified intelligence work. Features cryptographic agent verification, smart contract escrow payments with on-chain verification, Byzantine Fault Tolerant consensus, and Vector Logical Clock causal ordering for permissionless AI marketplaces.

## Overview

This system demonstrates a **permissionless AI marketplace** where agents earn soulbound FLUX tokens through verified intelligence work and receive AIUSD payments via trustless escrow. Combines three key innovations:

- **üÜî ERC-8004 Identity**: Decentralized agent registry with cryptographic verification and NFT-based identity
- **üí≥ x402 Payment Protocol**: Trustless escrow with on-chain payment verification - agents verify funds before processing
- **‚õèÔ∏è Proof-of-Causal-Work**: Byzantine Fault Tolerant consensus using Vector Logical Clocks for causal ordering

The **FLUX token** represents verifiable intelligence contributions and is non-transferable (soulbound) but redeemable, while **AIUSD stablecoin** enables instant, cryptographically-secured payments between clients and agents without trusted intermediaries.

### Key Features

- üß† **Intelligence Mining**: Earn FLUX tokens through actual AI task completion
- üí≥ **x402 Escrow Payments**: Trustless AIUSD payments with BFT consensus-based release
- üîó **Vector Logical Clocks**: Causal ordering of distributed consensus events
- üèõÔ∏è **Byzantine Fault Tolerant**: 4-validator consensus with quality assessment
- üíé **Soulbound Tokens**: Non-transferable but redeemable FLUX tokens
- üÜî **ERC-8004 Identity**: Trustless agent identity with NFT-based verification
- üìä **Real-time Visualization**: VLC event graph via Dgraph
- ‚õìÔ∏è **Blockchain Integration**: Smart contracts on Anvil/Ethereum
- üîí **Smart Contract Escrow**: Automatic payment release/refund based on validator consensus

## Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Subnet        ‚îÇ    ‚îÇ   Bridge         ‚îÇ    ‚îÇ   Blockchain            ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ                         ‚îÇ
‚îÇ Miner(8004) +   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ HTTP Server      ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ Smart Contracts         ‚îÇ
‚îÇ 4 Validators    ‚îÇ    ‚îÇ (Port 3001)      ‚îÇ    ‚îÇ (Anvil)                 ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ                         ‚îÇ
‚îÇ VLC Consensus   ‚îÇ    ‚îÇ Per-epoch        ‚îÇ    ‚îÇ ‚Ä¢ FLUX Mining            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ Submission       ‚îÇ    ‚îÇ ‚Ä¢ Token Rewards         ‚îÇ
         ‚îÇ             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ ‚Ä¢ ERC-8004 Identity     ‚îÇ
         ‚ñº                                     ‚îÇ ‚Ä¢ x402 Escrow Payments  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ   Dgraph        ‚îÇ                                        ‚îÇ
‚îÇ   VLC Graph     ‚îÇ              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ   Visualization ‚îÇ              ‚ñº
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ  x402 Payment Escrow ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ                      ‚îÇ
‚îÇ   Client        ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ ‚Ä¢ AIUSD Deposits     ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ    ‚îÇ ‚Ä¢ BFT Consensus      ‚îÇ    ‚îÇ   Agent     ‚îÇ
‚îÇ ‚Ä¢ Initiates     ‚îÇ    ‚îÇ ‚Ä¢ Release/Refund     ‚îÇ    ‚îÇ             ‚îÇ
‚îÇ   Tasks         ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ ‚Ä¢ Trustless Flow     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ ‚Ä¢ Performs  ‚îÇ
‚îÇ ‚Ä¢ Funds AIUSD   ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ   Work      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                 ‚îÇ ‚Ä¢ Gets Paid ‚îÇ
                                                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Two Execution Modes

### 1. Subnet-Only Mode üîπ

**Purpose**: Pure subnet consensus demonstration with VLC visualization (no blockchain integration)

**What it does**:
- ‚úÖ Runs distributed consensus with 1 miner(8004 Agent) + 4 validators
- ‚úÖ Processes 7 rounds of AI tasks with quality assessment  
- ‚úÖ Generates VLC event graph for causal analysis
- ‚úÖ Provides interactive exploration of consensus behavior
- ‚ùå No blockchain integration or FLUX token mining

**Run Command**:
```bash
./run-subnet-only.sh
```

**Access Points**:
- üìä VLC Graph: `http://localhost:8000` (Dgraph Ratel UI)
- üìã Event Query: `http://localhost:8080/graphql`

### 2. FLUX Mining Mode üí∞

**Purpose**: Complete PoCW system with FLUX mining, x402 escrow payments, and ERC-8004 identity

**What it does**:
- ‚úÖ Everything from subnet-only mode PLUS:
- ‚úÖ Deploys smart contracts (FLUX, AIUSD, x402PaymentEscrow, ERC-8004 Identity, etc.)
- ‚úÖ Real-time FLUX mining per epoch (every 3 rounds)
- ‚úÖ **x402 Trustless Escrow**: AIUSD payments with BFT consensus-based release/refund
- ‚úÖ **ERC-8004 Agent Identity**: NFT-based trustless agent verification
- ‚úÖ Blockchain transactions with verified rewards
- ‚úÖ Bridge service for epoch submission
- ‚úÖ Complete FLUX and AIUSD balance tracking
- ‚úÖ Demonstrates 5 successful payments + 2 refunds via escrow

**Run Command**:
```bash
./run-flux-mining.sh
```

**Access Points**:
- üìä VLC Graph: `http://localhost:8000`
- üîç Blockchain Inspector: `http://localhost:3000/pocw-inspector.html`
- ‚õìÔ∏è Blockchain RPC: `http://localhost:8545`
- üåê Bridge API: `http://localhost:3001`

**What You'll See**:
- **x402 Payment Requests**: Agent generates payment requests with task details
  ```
  üìã Agent sends x402 Payment Request to Client:
     Task ID: req-subnet-001-1
     Amount: 10000000000000000000 wei (10 AIUSD)
     Escrow Contract: 0x0165878A594ca255338adfa4d48449f69242Eb8F
  ```
- **Payment Deposits**: Client deposits AIUSD to escrow (10 AIUSD per task)
- **Agent Verification**: Agent verifies payment on-chain before processing
  ```
  ‚úÖ Payment verified for task req-subnet-001-1:
     Amount: 10.00 AIUSD (locked in escrow)
     Agent: 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc
  üîê Miner: Payment verified on-chain - proceeding with task
  ```
- **FLUX Mining**: 400 FLUX to miner, 80 FLUX to validators per epoch
- **BFT Consensus**: Validators decide payment release or refund
- **Payment Outcomes**: 5 payments released (50 AIUSD), 2 refunded (20 AIUSD)
- **Trustless Operation**: Complete audit trail of all payments on-chain

## Prerequisites

### Required Software
```bash
# Install Foundry (for Anvil and Cast)
curl -L https://foundry.paradigm.xyz | bash
foundryup

# Install Go >= 1.21
# Install Node.js >= 22
# Install Docker (for Dgraph)
# Install bc (for calculations)
sudo apt install bc
```

### System Requirements
- **Ports**: 3000, 3001, 8000, 8080, 8545, 9080 (must be available)
- **Docker**: Required for Dgraph container
- **Sudo Access**: Required for Docker operations

## Quick Start

### Option 1: Subnet-Only Demo
```bash
# Clean run of subnet consensus with VLC visualization
sudo ./run-subnet-only.sh

# Access VLC graph at http://localhost:8000
# Press Ctrl+C when done exploring
```

### Option 2: Full FLUX Mining Demo  
```bash
# Complete PoCW system with blockchain integration
sudo ./run-flux-mining.sh

# Watch FLUX tokens being mined in real-time
# Explore blockchain inspector at http://localhost:3000/pocw-inspector.html
# Bridge stays active for continued mining
# Press Ctrl+C when done
```

## Smart Contracts

| Contract | Purpose | Features |
|----------|---------|----------|
| **FLUXToken** | Soulbound intelligence tokens | Non-transferable, 21M max supply |
| **HETUToken** | Staking for subnet registration | ERC20, 1M total supply |
| **AIUSD** | AI services stablecoin | ERC20, USD-pegged, for x402 payments |
| **x402PaymentEscrow** | Trustless payment escrow | BFT consensus-based release/refund, reentrancy protection |
| **SubnetRegistry** | Manages subnet participants with identity | ERC-8004 identity verification, deposit requirements |
| **PoCWVerifier** | Consensus verification & mining | Per-epoch FLUX distribution, validator authorization |
| **IdentityRegistry** | ERC-8004 Trustless Agents identity | NFT-based agent IDs, ownership verification |
| **ValidationRegistry** | Agent validation requests | Quality assessments, reputation tracking |
| **ReputationRegistry** | Agent reputation system | Score tracking, signed attestations |

## ERC-8004 Identity Integration

This system implements the **ERC-8004 Trustless Agents** standard, providing verifiable identity for AI agents participating in the PoCW network.

### Identity System

**üÜî Agent Identity NFTs**
- Each AI agent is represented by a unique NFT token ID
- Agent ownership is cryptographically verified on-chain
- Agents must prove ownership to participate in subnet mining
- Identity registry tracks agent metadata and ownership history

**üîê Subnet Registration with Identity**
```
Registration Requirements:
1. Agent owner mints identity NFT from IdentityRegistry
2. Owner registers subnet with their agent ID
3. Smart contract verifies: identityRegistry.ownerOf(agentId) == minerAddress
4. Only verified agents can participate in consensus and mining
```

**‚úÖ Benefits**
- **Trustless Verification**: No central authority needed for agent authentication
- **Ownership Proof**: Cryptographic proof of agent control
- **Reputation Tracking**: Identity persists across epochs and subnets
- **Sybil Resistance**: One agent ID per subnet, preventing duplicate participation

**üìä Blockchain Inspector**

The web inspector at `http://localhost:3000/pocw-inspector.html` provides:
- View all registered agent identities
- Check agent ID ownership and metadata
- Track which agents are active in subnets
- Monitor identity-verified FLUX mining rewards

## üí≥ x402 Payment System with Smart Escrow

The system now integrates **x402 protocol** for trustless, escrow-based AIUSD stablecoin payments between clients and AI agents, leveraging permissionless validator consensus.

### Revolutionary Payment Architecture

**üîí Trustless Escrow-Based Payments**
```
Traditional AI Services:  Client ‚Üí Platform ‚Üí Agent (Platform controls funds)
x402 Escrow System:      Client ‚Üí Smart Contract ‚Üí Agent (Code controls funds)
```

The x402 payment system eliminates trusted intermediaries by using smart contract escrow combined with BFT validator consensus for payment release decisions.

### Payment Flow Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    x402 Payment Escrow Lifecycle                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1Ô∏è‚É£ PAYMENT REQUEST PHASE
   Client                    Escrow Contract              Agent
     ‚îÇ                              ‚îÇ                        ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ Task Request ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ
     ‚îÇ                              ‚îÇ                        ‚îÇ
     ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ x402 Payment Request ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ         {taskId, amount,     ‚îÇ                        ‚îÇ
     ‚îÇ          escrow, agent,      ‚îÇ                        ‚îÇ
     ‚îÇ          token, deadline}    ‚îÇ                        ‚îÇ

2Ô∏è‚É£ DEPOSIT PHASE
     ‚îÇ                              ‚îÇ                        ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ approve(AIUSD) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                        ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ depositPayment() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                        ‚îÇ
     ‚îÇ                              ‚îÇ ‚úì Funds locked         ‚îÇ
     ‚îÇ                              ‚îÇ                        ‚îÇ

3Ô∏è‚É£ VERIFICATION & PROCESSING PHASE
     ‚îÇ                              ‚îÇ                        ‚îÇ
     ‚îÇ                              ‚îÇ ‚óÑ‚îÄ Agent Verifies ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ                              ‚îÇ    (blockchain query)  ‚îÇ
     ‚îÇ                              ‚îÇ    ‚úì Payment confirmed ‚îÇ
     ‚îÇ                         [Validator Network]           ‚îÇ
     ‚îÇ                              ‚îÇ                        ‚îÇ
     ‚îÇ                         ‚îÇ ‚îÄ‚îÄ‚îÄ Forward Task ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ
     ‚îÇ                         ‚îÇ ‚óÑ‚îÄ‚îÄ Agent Processes ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ                         ‚îÇ   (generates output/result) ‚îÇ

4Ô∏è‚É£ CONSENSUS PHASE
     ‚îÇ                              ‚îÇ                        ‚îÇ
     ‚îÇ                         [Validator Network]           ‚îÇ
     ‚îÇ                         Quality > 0.5? ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂ BFT Vote ‚îÇ
     ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ Result Preview ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ User Accept/Reject ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ                        ‚îÇ

5Ô∏è‚É£ FINALIZATION PHASE
     ‚îÇ                              ‚îÇ                        ‚îÇ
     ‚îÇ    If Quality > 0.5 AND User Accepts:                 ‚îÇ
     ‚îÇ                              ‚îú‚îÄ releasePayment() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ
     ‚îÇ                              ‚îÇ  ‚úì Agent receives AIUSD ‚îÇ
     ‚îÇ                              ‚îÇ                        ‚îÇ
     ‚îÇ    If Quality ‚â§ 0.5 OR User Rejects:                  ‚îÇ
     ‚îú‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ refundPayment() ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                        ‚îÇ
     ‚îÇ  ‚úì Client receives refund    ‚îÇ                        ‚îÇ
```

### Smart Contract Escrow System

**üîê x402PaymentEscrow Contract**

The escrow contract manages the entire payment lifecycle with cryptographic guarantees:

**x402 Payment Request (Agent ‚Üí Client):**
```json
{
  "taskId": "req-subnet-001-1",
  "amount": "10000000000000000000",  // 10 AIUSD in wei
  "asset": {
    "symbol": "AIUSD",
    "contract": "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512",
    "decimals": 18
  },
  "escrow": {
    "contract": "0x0165878A594ca255338adfa4d48449f69242Eb8F",
    "timeout": 60  // seconds
  },
  "agent": {
    "address": "0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc",
    "agentId": "0"
  }
}
```

**Key Functions:**
```solidity
// Public view function - Agent verifies payment before processing
mapping(bytes32 => TaskPayment) public payments;

// Client deposits AIUSD for a task (via coordinator)
function depositPayment(
    bytes32 taskId,
    address client,
    address agent,
    uint256 amount,
    uint256 deadline
) external onlyCoordinator

// Release payment to agent after consensus approval
function releasePayment(bytes32 taskId) external onlyCoordinator

// Refund payment to client if rejected
function refundPayment(bytes32 taskId) external onlyCoordinator
```

**Security Features:**
- ‚úÖ **Payment Verification**: Agent queries blockchain for cryptographic proof before processing
- ‚úÖ **Trustless Operation**: Agent doesn't trust validator - verifies payment on-chain
- ‚úÖ **Reentrancy Protection**: Guards against reentrancy attacks
- ‚úÖ **Authorization Control**: Only authorized validators can finalize payments
- ‚úÖ **Payment States**: Tracks NONE ‚Üí DEPOSITED ‚Üí RELEASED/REFUNDED
- ‚úÖ **Deadline Enforcement**: Time-based payment safety with agent verification
- ‚úÖ **Event Emission**: Complete audit trail of all payment operations

### Permissionless Validator Consensus

**üèõÔ∏è BFT-Based Payment Decisions**

Payment finalization is determined by the same Byzantine Fault Tolerant consensus used for task validation:

**Validator Network:**
- 4 independent validator nodes
- 0.25 voting weight each (total = 1.0)
- Tolerates up to 1 Byzantine (malicious) validator
- Quality threshold: Tasks must score > 0.5 to qualify for payment

**Consensus Decision Logic:**
```go
if qualityScore > 0.5 && userAccepted {
    // ‚úÖ Release payment from escrow to agent
    releasePayment(taskId)
} else {
    // ‚Ü©Ô∏è Refund payment from escrow to client
    refundPayment(taskId)
}
```

**Why This Works:**
- **Objective Quality Metrics**: Validators assess task completion quality independently
- **User Final Authority**: Client has ultimate veto power even if validators approve
- **Permissionless Operation**: Any validator can join with stake, no platform approval needed
- **Economic Alignment**: Validators earn rewards for honest consensus participation

### Payment Token: AIUSD Stablecoin

**üíµ AIUSD - AI Services Stablecoin**

The system uses AIUSD, an ERC-20 stablecoin specifically designed for AI service payments:

**Properties:**
- Pegged to USD for price stability
- Standard ERC-20 transferability
- Minted for testing/demonstration purposes
- Used for all client-to-agent payments

**Client Payment Workflow:**
```bash
1. Client receives AIUSD tokens (1000 AIUSD in demo)
2. Client sends task request to agent
3. Agent generates x402 payment request with details:
   - Task ID, amount (10 AIUSD), escrow address, agent address, deadline
4. Client approves escrow contract to spend AIUSD
5. Client deposits payment to escrow contract
6. Agent verifies payment on-chain before processing
   - Queries blockchain: payments[taskId].status == DEPOSITED
   - Verifies: correct agent, sufficient amount, deadline valid
7. Agent processes task only after payment verification
8. AIUSD locked in escrow until consensus decision (release/refund)
```

### Demonstrated Payment Scenarios

The demo processes **7 payment scenarios** showing the full range of outcomes:

**‚úÖ Successful Payments (5 tasks)**
```
Task 1, 2, 3, 5, 7:
- Quality Score: > 0.5
- User Feedback: Accepted
- Result: 10 AIUSD released to agent per task
- Total: 50 AIUSD paid to agent
```

**‚Ü©Ô∏è Refunded Payments (2 tasks)**
```
Task 4:
- Quality Score: < 0.5 (validator rejection)
- Result: 10 AIUSD refunded to client

Task 6:
- Quality Score: > 0.5 (validators approved)
- User Feedback: Rejected
- Result: 10 AIUSD refunded to client
```

**Final Balances:**
```
Client:  1000 ‚Üí 950 AIUSD (-50 paid, +20 refunded)
Agent:   0 ‚Üí 50 AIUSD (5 successful tasks)
```

### Economic Security Model

**üõ°Ô∏è Multi-Layer Protection**

**For Clients:**
- ‚úÖ Funds locked in escrow, not controlled by agent
- ‚úÖ Automatic refund if quality too low
- ‚úÖ Veto power even if validators approve
- ‚úÖ Time-based deadline protection

**For Agents:**
- ‚úÖ Guaranteed payment for quality work
- ‚úÖ Objective quality assessment by validators
- ‚úÖ Protection against malicious client rejection via validator approval requirement
- ‚úÖ Cryptographic proof of task completion

**For the Network:**
- ‚úÖ No trusted intermediary needed
- ‚úÖ Validators earn rewards for honest consensus
- ‚úÖ Sybil-resistant through ERC-8004 identity
- ‚úÖ Complete payment audit trail on-chain

### Smart Contract Addresses

After deployment, the system creates:

```json
{
  "AIUSD": "0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512",
  "x402PaymentEscrow": "0x0165878A594ca255338adfa4d48449f69242Eb8F",
  "IdentityRegistry": "0x5FbDB2315678afecb367f032d93F642f64180aa3"
}
```

### Integration with FLUX Mining

The x402 payment system operates **in parallel** with FLUX token mining:

**Dual Reward Structure:**
```
Successful Task Completion:
  ‚îú‚îÄ FLUX Tokens: Mined for verifiable intelligence work (soulbound)
  ‚îî‚îÄ AIUSD Payment: Released from escrow for service rendered (transferable)
```

**Why Both?**
- **FLUX**: Represents reputation and long-term capability (non-transferable)
- **AIUSD**: Provides immediate economic compensation (transferable stablecoin)
- **Combined**: Creates sustainable economic model for AI agents

This dual-token model ensures agents build reputation (FLUX) while earning liquid compensation (AIUSD), creating the world's first **merit-based AI economy** with trustless payments.

## Expected Output

### Subnet-Only Mode
```
üîπ PoCW SUBNET-ONLY DEMONSTRATION
Architecture: Pure subnet consensus with VLC graph visualization

‚úÖ 7 rounds processed with Byzantine consensus
‚úÖ VLC events committed to Dgraph
üîÑ Interactive mode - explore at http://localhost:8000
```

### FLUX Mining Mode
```
üí∞ PoCW FLUX MINING SYSTEM WITH x402 PAYMENTS
Architecture: Complete FLUX mining with blockchain integration + escrow payments

üí∞ Initial FLUX Token Balances (Before Mining)
üìä Miner: 0.000000 FLUX
üìä Validator-1: 0.000000 FLUX
...

üíµ Initial AIUSD Token Balances (x402 Payment System)
üìä Client: 1000.000000 AIUSD
üìä Agent: 0 AIUSD
üìä Escrow: 0 AIUSD

[CONSENSUS & MINING HAPPENS WITH ESCROW PAYMENTS]

üí∞ Final FLUX Token Balances (After Mining)
üìä Miner: 400.000000 FLUX (+400.000000 FLUX mined)
üìä Validator-1: 80.000000 FLUX (+80.000000 FLUX mined)
üìä Total Supply: 480.000000 FLUX (+480.000000 FLUX total mined)

üíµ Final AIUSD Token Balances (x402 Payment System)
üìä Client: 950.000000 AIUSD (-50 paid, +20 refunded from escrow)
üìä Agent: 50.000000 AIUSD (5 tasks √ó 10 AIUSD released from escrow)
üìä Demonstrated: 5 successful payments + 2 refunds via BFT consensus

üéâ Bridge stays running for continued FLUX mining!
‚ú® Escrow payment system active for trustless client-agent transactions!
```

## Key Concepts

### Epochs & Rounds
- **Round**: Single AI task with miner output + validator consensus
- **Epoch**: 3 consecutive rounds
- **Mining Trigger**: Each completed epoch triggers FLUX token mining

### VLC (Vector Logical Clocks)
- Ensures causal ordering of distributed events
- Tracks happened-before relationships
- Prevents Byzantine inconsistencies
- Visualized as directed graphs in Dgraph

### FLUX Token Economics
- **Mining Rate**: Based on successful task completion
- **Distribution**: 80% to miner, 20% split among validators
- **Soulbound**: Cannot be transferred, but can be redeemed
- **Max Supply**: 21 million FLUX (like Bitcoin)

## Troubleshooting

### Common Issues

**Port Conflicts**:
```bash
# Check what's using required ports
netstat -tlnp | grep -E ":(3000|3001|8000|8080|8545|9080)"
# Kill conflicting processes if needed
```

**Docker Permissions**:
```bash
# Run the scripts with sudo to handle Docker operations
sudo ./run-subnet-only.sh
sudo ./run-flux-mining.sh
```

**Bridge Connection Errors**:
- Ensure Node.js dependencies are installed: `npm install`
- Bridge starts after contract deployment in flux-mining mode
- Check bridge health: `curl http://localhost:3001/health`

**Dgraph Issues**:
- Wait 30+ seconds for Dgraph container to fully start
- Try accessing Ratel UI directly: `http://localhost:8000`
- Check container: `docker ps | grep dgraph`

### Clean Restart
```bash
# If anything gets stuck, clean everything:
pkill anvil
sudo docker stop dgraph-standalone
sudo docker rm dgraph-standalone  
sudo rm -rf ./dgraph-data
rm -f contract_addresses.json *.log *.pid
```

## üèóÔ∏è Architecture Overview

### Core Components

**ü§ñ CoreMiner**
- AI agents that process user tasks and requests
- Maintain Vector Logical Clock (VLC) consistency
- Generate responses and request additional context when needed
- Process 7 different test scenarios demonstrating various interaction patterns

**üõ°Ô∏è CoreValidator** 
- Quality assessment nodes that vote on miner outputs
- Two specialized roles:
  - **UserInterfaceValidator**: Handles user interaction and info requests
  - **ConsensusValidator**: Performs distributed quality voting
- Byzantine Fault Tolerant consensus with 0.25 weight per validator
- Validates VLC sequences and ensures causal consistency

**‚è∞ Vector Logical Clocks (VLC)**
- Ensures causal ordering of all operations
- Tracks dependencies between events across the network
- Prevents out-of-order execution and maintains consistency
- Critical for distributed consensus and event validation

**üìä Graph Visualization**
- Real-time VLC event tracking via Dgraph database
- Interactive visualization of causal relationships
- Event categorization: UserInput, MinerOutput, InfoRequest, RoundSuccess, etc.
- Complete audit trail of all network interactions

## üéØ Demonstration Scenarios

The subnet demo processes **7 test scenarios** that showcase all aspects of the PoCW protocol:

### Standard Processing (Scenarios 1, 2, 5, 7)
- **User Input**: "Analyze market trends for Q4"
- **Miner Response**: Direct solution generation
- **Validator Assessment**: Quality voting and consensus
- **User Feedback**: Acceptance confirmation
- **Result**: `OUTPUT DELIVERED TO USER`

### Information Request Flow (Scenarios 3, 6)  
- **User Input**: "Create optimization strategy for resource allocation"
- **Miner Behavior**: Requests additional context
- **Validator Mediation**: Facilitates user-miner communication
- **Enhanced Processing**: Solution with additional context
- **Advanced Validation**: Quality assessment of refined output

### Rejection Scenarios (Scenario 4)
- **Validator Rejection**: Low-quality output rejected by consensus (0.45 quality score)
- **Result**: `OUTPUT REJECTED BY VALIDATORS`

### User Override (Scenario 6)
- **Validator Acceptance**: Output passes validator consensus
- **User Rejection**: User rejects despite validator approval
- **Result**: `OUTPUT REJECTED BY USER (despite validator acceptance)`

## üìä Visualizing Event Graphs

After running the demonstration, visualize the complete VLC event graph:

### Access Steps
1. **Open Ratel UI**: http://localhost:8000
2. **Verify Connection**: Ensure connection shows `localhost:8080`
3. **Query Events**: Use this DQL query to view all subnet events:

```graphql
{
  events(func: has(id)) {
    uid
    id
    name
    clock
    depth
    value
    key
    node
    parent {
      uid
      id
      name
    }
  }
}
```

### Event Types in Subnet Demo
- **üéØ UserInput**: User task submissions (7 scenarios)
- **ü§ñ MinerOutput**: AI agent responses and solutions
- **‚ùì InfoRequest**: Miner requests for additional context  
- **üí¨ InfoResponse**: User-provided clarifications
- **‚úÖ RoundSuccess**: Successful consensus rounds
- **‚ùå RoundFailed**: Failed validation or user rejection
- **üèÅ EpochFinalized**: Subnet epoch completion markers
- **‚≠ê GenesisState**: Initial subnet state

### Understanding VLC Relationships
- **Parent Links**: Show causal dependencies between events
- **VLC Clocks**: Demonstrate proper ordering (format: `{miner:X, validator:Y}`)

The graph provides a complete audit trail showing how each user request flows through the subnet, demonstrating the causal consistency guarantees of the PoCW protocol.

## üß† Intelligence Money & PoCW Protocol

### Proof-of-Causal-Work Consensus

PoCW extends traditional blockchain consensus by focusing on **causal relationships** rather than just computational work:

**üîó Causal Consistency**
- Every event must reference its causal dependencies
- Vector Logical Clocks ensure proper ordering across distributed nodes
- Invalid causal relationships are automatically rejected
- Creates immutable audit trail of decision-making processes

**üèõÔ∏è Byzantine Fault Tolerant Consensus**  
- 4 validators with 0.25 weight each (total weight = 1.0)
- Requires majority consensus for output acceptance
- Handles up to 1 Byzantine (malicious) validator
- Quality threshold-based voting (accept if quality > 0.5)

**‚ö° Event-Driven Architecture**
- Real-time processing of user requests
- Dynamic info request/response cycles
- Asynchronous validator consensus
- Complete traceability of all interactions 

### Blockchain Integration Architecture

The system integrates multiple on-chain components for trustless operation:

```
üèóÔ∏è Complete Blockchain Architecture:

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         Ethereum Blockchain                      ‚îÇ
‚îÇ                         (Anvil Local Testnet)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                         ‚îÇ                         ‚îÇ
        ‚ñº                         ‚ñº                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ERC-8004      ‚îÇ      ‚îÇ x402 Payment     ‚îÇ      ‚îÇ FLUX Token      ‚îÇ
‚îÇ Agent Registry‚îÇ      ‚îÇ Escrow Contract  ‚îÇ      ‚îÇ Mining Contract ‚îÇ
‚îÇ               ‚îÇ      ‚îÇ                  ‚îÇ      ‚îÇ                 ‚îÇ
‚îÇ ‚Ä¢ Agent ID: 0 ‚îÇ      ‚îÇ ‚Ä¢ AIUSD Deposits ‚îÇ      ‚îÇ ‚Ä¢ Soulbound NFT ‚îÇ
‚îÇ ‚Ä¢ Identity    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ ‚Ä¢ Payment Verify ‚îÇ      ‚îÇ ‚Ä¢ Epoch Rewards ‚îÇ
‚îÇ ‚Ä¢ Metadata    ‚îÇ      ‚îÇ ‚Ä¢ Release/Refund ‚îÇ      ‚îÇ ‚Ä¢ VLC Proof     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                         ‚îÇ                         ‚îÇ
        ‚îÇ                         ‚îÇ                         ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ
                                  ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   AIUSD Stablecoin      ‚îÇ
                    ‚îÇ   (ERC-20 Token)        ‚îÇ
                    ‚îÇ                         ‚îÇ
                    ‚îÇ ‚Ä¢ Client Payments       ‚îÇ
                    ‚îÇ ‚Ä¢ Agent Compensation    ‚îÇ
                    ‚îÇ ‚Ä¢ Escrow Transfers      ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

üìä Payment & Mining Flow:
1. Agent generates x402 payment request
2. Client deposits AIUSD to escrow contract
3. Agent verifies payment on-chain (trustless)
4. Agent processes task after verification
5. BFT validators reach consensus on quality
6. Escrow releases payment OR refunds client
7. FLUX tokens mined based on epoch completion
```

## üí∞ Intelligence Money (FLUX Tokens)

### Revolutionary Digital Asset Class

Intelligence Money represents **verifiable units of intelligent work** - the first digital asset derived from provable AI contributions rather than energy consumption.

**üéØ Core Principles**
```
Traditional Crypto:  Energy ‚Üí Computational Work ‚Üí Token Value
Intelligence Money:   AI Work ‚Üí Verified Contribution ‚Üí FLUX Value
```

### Mining Through Value Creation

**üèóÔ∏è The Mining Process**
1. **Query Initiation**: User submits complex problem to subnet
2. **AI Collaboration**: Miners and validators work together via PoCW
3. **Quality Validation**: BFT consensus ensures solution quality  
4. **Value Attribution**: Successful contributions mine new FLUX tokens
5. **Cryptographic Proof**: VLC graph provides immutable work evidence

**‚ö° Real-Time Mining**
- Every accepted user solution mines new tokens
- Quality multipliers affect mining rewards
- Validator consensus participation earns rewards
- Failed outputs generate no tokens (merit-based system)

### Soulbound Token Economics

**üîí Non-Transferable Design**
- **Soulbound**: FLUX tokens cannot be transferred between addresses
- **Reputation-Based**: Tokens represent earned capability and track record
- **Anti-Speculation**: Prevents market manipulation and speculation bubbles
- **Cryptographic Resume**: Immutable proof of AI agent competence

**üíµ Liquidity Bridge**
- **Redemption Pool**: One-way bridge to stablecoins (USDC/USDT)
- **Burn Mechanism**: FLUX tokens are destroyed when redeemed
- **Market Valuation**: Exchange rate determined by supply/demand
- **Utility Preservation**: Core reputation asset remains non-transferable

### Economic Model

```
üîÑ VALUE FLOW:
User Problem ‚îÄ‚îÄ‚ñ∂ AI Solution ‚îÄ‚îÄ‚ñ∂ Quality Validation ‚îÄ‚îÄ‚ñ∂ FLUX Mining ‚îÄ‚îÄ‚ñ∂ Stablecoin Redemption
     ‚ñ≤                                      ‚îÇ                              ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Economic Feedback Loop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

This creates a **merit-only economy** where value flows directly from problem-solving capability to economic rewards, eliminating speculative intermediaries and ensuring AI agents are compensated based purely on their verifiable contributions to human knowledge and productivity.

## üõ†Ô∏è Development & Contributing

### Project Structure
```
Intelligence-FLUX-Mining/
‚îú‚îÄ‚îÄ main.go                     # Entry point - subnet demonstration
‚îú‚îÄ‚îÄ go.mod                      # Go module dependencies
‚îú‚îÄ‚îÄ run-subnet-only.sh          # Subnet consensus only mode
‚îú‚îÄ‚îÄ run-flux-mining.sh           # Full FLUX mining mode with ERC-8004 identity
‚îú‚îÄ‚îÄ serve-dashboard.go          # Web UI server (integrated into scripts)
‚îú‚îÄ‚îÄ mainnet-bridge-per-epoch.js # HTTP bridge service (port 3001)
‚îú‚îÄ‚îÄ pocw-inspector.html         # Blockchain inspector UI with identity
‚îú‚îÄ‚îÄ contracts/                  # Solidity smart contracts
‚îÇ   ‚îú‚îÄ‚îÄ FLUXToken.sol           # Soulbound FLUX tokens
‚îÇ   ‚îú‚îÄ‚îÄ HETUToken.sol          # Staking token
‚îÇ   ‚îú‚îÄ‚îÄ AIUSD.sol              # AI services stablecoin for x402 payments
‚îÇ   ‚îú‚îÄ‚îÄ x402PaymentEscrow.sol  # Trustless escrow for client-agent payments
‚îÇ   ‚îú‚îÄ‚îÄ SubnetRegistry.sol     # Subnet management with ERC-8004 identity
‚îÇ   ‚îú‚îÄ‚îÄ PoCWVerifier.sol       # Consensus verification & FLUX mining
‚îÇ   ‚îî‚îÄ‚îÄ 8004/                  # ERC-8004 Trustless Agents standard
‚îÇ       ‚îú‚îÄ‚îÄ IdentityRegistry.sol    # Agent identity NFTs
‚îÇ       ‚îú‚îÄ‚îÄ ValidationRegistry.sol  # Agent validation system
‚îÇ       ‚îî‚îÄ‚îÄ ReputationRegistry.sol  # Agent reputation tracking
‚îú‚îÄ‚îÄ subnet/                    # Go consensus implementation
‚îÇ   ‚îú‚îÄ‚îÄ core_miner.go         # AI miner agents
‚îÇ   ‚îú‚îÄ‚îÄ core_validator.go     # BFT validators
‚îÇ   ‚îú‚îÄ‚îÄ graph_adapter.go      # VLC graph & HTTP bridge integration
‚îÇ   ‚îú‚îÄ‚îÄ messages.go           # Protocol message definitions
‚îÇ   ‚îî‚îÄ‚îÄ demo/                 # Demo scenarios & coordination
‚îÇ       ‚îú‚îÄ‚îÄ demo_coordinator.go      # Demo orchestration
‚îÇ       ‚îú‚îÄ‚îÄ demo_task_processor.go   # Task processing logic
‚îÇ       ‚îú‚îÄ‚îÄ demo_quality_assessor.go # Quality assessment
‚îÇ       ‚îî‚îÄ‚îÄ demo_user_interaction.go # User interface simulation
‚îú‚îÄ‚îÄ vlc/                      # Vector Logical Clock library
‚îÇ   ‚îî‚îÄ‚îÄ vlc.go               # VLC implementation
‚îú‚îÄ‚îÄ dgraph/                   # Graph database integration
‚îÇ   ‚îú‚îÄ‚îÄ connection.go        # Dgraph client connection
‚îÇ   ‚îî‚îÄ‚îÄ init.go              # Dgraph initialization
‚îú‚îÄ‚îÄ models/                   # Data models
‚îÇ   ‚îî‚îÄ‚îÄ event.go             # Event structure definitions
‚îú‚îÄ‚îÄ scripts/                  # Deployment scripts
‚îÇ   ‚îî‚îÄ‚îÄ deploy-identity-phase1.js  # Standalone identity deployment
‚îî‚îÄ‚îÄ tests/                    # Test utilities
```

### Adding New Features
1. **Subnet Logic**: Modify files in `subnet/` directory
2. **Smart Contracts**: Update contracts in `contracts/` directory  
3. **Bridge Logic**: Enhance `mainnet-bridge-per-epoch.js`
4. **UI Components**: Update `pocw-inspector.html`

## License

MIT License - See [LICENSE](LICENSE) for details.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Test with both `./run-subnet-only.sh` and `./run-flux-mining.sh`
4. Submit a pull request

---

üåü **Start with `./run-subnet-only.sh` to understand the consensus, then try `./run-flux-mining.sh` for the full FLUX mining experience!**

**Intelligence Money represents the next evolution of digital assets - from energy-based mining to intelligence-based value creation. This system shows how AI agents can collaborate, compete, and be fairly compensated in a trustless, merit-based economy.**
